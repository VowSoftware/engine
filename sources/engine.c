////////////////////////////////////////////////////////////////////////////////
// Dependencies
////////////////////////////////////////////////////////////////////////////////

#include <vowengine/private/timer.h>

#include <vowengine/engine.h>

#define GLFW_INCLUDE_NONE
#include <glfw/glfw3.h>

#include <assert.h>

////////////////////////////////////////////////////////////////////////////////
// Types
////////////////////////////////////////////////////////////////////////////////

typedef struct VowEngineData
{
    float lastTime;
}
VowEngineData;

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////

static VowEngineData vow_engine_data = { 0 };

////////////////////////////////////////////////////////////////////////////////
// Functions
////////////////////////////////////////////////////////////////////////////////

static void glfw_error_callback(int error_code, const char* description)
{
    vow_log_print(VOW_LOG_LEVEL_ERROR, "GLFW: %d %s", error_code, description);
}

////////////////////////////////////////////////////////////////////////////////
// Functions <vowengine/engine.h>
////////////////////////////////////////////////////////////////////////////////

void vow_engine_initialize(void)
{
    glfwSetErrorCallback(glfw_error_callback);
    assert(glfwInit());
    vow_timer_initialize();
}

void vow_engine_finalize(void)
{
    vow_timer_finalize();
    glfwTerminate();
    vow_engine_data = (VowEngineData) { 0 };
}

void vow_engine_update(void)
{
    const float totalTime = (float) glfwGetTime();
    const float frameTime = totalTime - vow_engine_data.lastTime;
    vow_timer_update(frameTime);
    vow_engine_data.lastTime = totalTime;
}